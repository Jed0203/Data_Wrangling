---
title: "W7: Tidyquant"
execute:
  keep-md: true
  df-print: paged
  warning: false
  echo: false
format:
  html:
    code-fold: true
    code-line-numbers: true
    fig-width: 10
date: "`r format(Sys.time(), '%B %d, %Y')`"
editor_options: 
  chunk_output_type: console
---

```{r}
library(tidyverse, warn.conflicts = FALSE)
library(tidyquant)
```

```{r}
AAPL <- tq_get("AAPL", get = "stock.prices", from = "2015-09-01", to = "2016-12-31")
AAPL %>%
    ggplot(aes(x = date, y = close)) +
    geom_line() +
    labs(title = "AAPL Line Chart", y = "Closing Price", x = "") + 
    theme_tq()
```

```{r}
your_friends_picks <- c("INTC", "NVDA", "AMZN")  # Replace with actual stock symbols
your_picks <- c("TSM", "TSLA", "NFLX")  # Replace with actual stock symbols
```

```{r}
all_picks <- c(your_friends_picks, your_picks)
stock_data <- tq_get(all_picks, from = "2023-01-01", to = "2023-10-27")

```

```{r}
stock_data_picker <- stock_data %>%
  mutate(Picker = ifelse(symbol %in% your_friends_picks, "Friend", "You"))

```

```{r}
ggplot(stock_data_picker, aes(x = date, y = adjusted, color = Picker)) +
  geom_point() +
  labs(
    title = "Stock Performance Competition",
    x = "Date",
    y = "Adjusted Price",
    color = "Picker"
  ) +
  scale_color_manual(values = c("Friend" = "blue", "You" = "red")) +
  theme_minimal()
```

```{r}
stock_data_winner <- stock_data_picker %>%
  group_by(Picker, symbol) %>%
  arrange(date) %>%
  mutate(Cumulative_Return = cumprod(1 + (adjusted - lag(adjusted, default = first(adjusted))) / lag(adjusted, default = first(adjusted)))) %>%
  ungroup()
```

```{r}
# Create a data frame with the winning picker and the stocks that belong to them
winner <- stock_data_winner %>%
  group_by(Picker) %>%
  summarise(Total_Return = last(Cumulative_Return)) %>%
  slice_max(order_by = Total_Return)

winning_stocks <- stock_data_winner %>%
  filter(Picker == winner$Picker)

```

```{r}
# Plot the performance over time with a shaded area for winning stocks
ggplot(winning_stocks, aes(x = date, y = Cumulative_Return, color = symbol)) +
  geom_line() +
  labs(
    title = "Winner's Stock Performance",
    x = "Date",
    y = "Cumulative Return",
    color = "Stock Symbol"
  ) +
  scale_color_manual(values = c("INTC" = "blue", "NVDA" = "red", "AMZN" = "green", "TSM" = "purple", "TSLA" = "orange", "NFLX" = "brown")) +
  theme_minimal()
```

The first chart, titled "Stock Performance Competition," presents a straightforward comparison between the two participants. The choice of color-coding the Friend's stocks in blue and Your stocks in red helps distinguish their performance clearly. However, this chart does not provide a direct insight into which stocks contributed the most to the winner's success.

To address this, a second chart titled "Winner's Stock Performance" was created to specifically showcase the stocks that led to the winner's victory. In this chart, the relative performance of the winning stocks---INTC, NVDA, and AMZN---is displayed in distinct colors. This chart highlights the impact of these particular stocks on the overall success of the winner. The chosen colors for the stocks are intended to make it easy for the viewer to identify each stock.
